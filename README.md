深度情報を用いた下り階段・段差検出プログラム

概要
本プログラムは、Intel RealSense深度カメラから得られる深度情報（Depth Map）を用い、歩行者の進行方向にある「下り階段」や「段差（崖）」をリアルタイムで検出するシステムである。
点群処理による床面推定（RANSAC）と、2D画像処理による境界検出（モルフォロジー演算）を組み合わせることで、ノイズの多い環境下でも堅牢な検出を実現している。
音声通知は未実装

主な特徴
3D/2Dハイブリッド処理: 3D点群による正確な床面特定と、2D画像処理による高速なエッジ検出を統合。
RANSACアルゴリズム: ノイズを含む深度データから、主要な床面平面をロバストに推定。
崖（Cliff）判定ロジック: 床面の境界（エッジ）を特定し、その「内側（床）」と「外側（空間）」の深度差を比較することで、下り階段のみを抽出。
デバッグ機能: 中間処理（モルフォロジー変換の過程など）を可視化するウィンドウを搭載し、パラメータ調整が容易。
BAGファイル対応: 録画済みの.bagファイルによるオフライン検証と、ライブカメラによるリアルタイム動作の両方に対応。

動作環境・必要要件
ハードウェア
Intel RealSense D400シリーズ (D415, D435, D455等)

ソフトウェア / ライブラリ
Python 3.8以上推奨。以下のライブラリが必要である。
pyrealsense2 (RealSense SDK)
open3d (点群処理)
opencv-python (画像処理)
numpy (数値計算)
tkinter (ファイル選択ダイアログ用 / 標準ライブラリに含まれる場合が多い)

アルゴリズム解説
本プログラムにおける検出パイプラインは以下の通りである。

前処理 (Preprocessing)：深度画像の欠損を補間するため、Spatial Filter（空間フィルタ）およびTemporal Filter（時間フィルタ）を適用。
床面検出 (Floor Detection)：深度画像を3D点群に変換し、Voxel Downsamplingでデータ量を削減。
RANSAC (Random Sample Consensus) ：アルゴリズムを用い、点群の中から最も支配的な平面（床面）の数式モデルを推定する。
境界抽出 (Boundary Extraction)：推定された平面モデルに基づき、深度画像上で「床面領域」のマスクを作成。モルフォロジー演算（クロージング、オープニング、穴埋め）を行い、ノイズを除去した滑らかな床面マスクを生成。床面マスクを膨張（Dilate）させたものとの差分を取り、床の「境界線」を抽出する。
下り階段判定 (Cliff Classification)：境界線の「すぐ内側（床）」と「すぐ外側」の深度値を比較。「外側の深度」が「内側の深度」よりも有意に深い（遠い）場合、その境界を「下り階段（崖）」として検出する。

設定 (Configuration)
AppConfig クラス内の定数を変更することで、環境に応じた調整が可能である。
RANSAC_DISTANCE_THRESHOLD: 床面判定の許容誤差（m）。
CLIFF_DEPTH_THRESHOLD: 下り階段とみなす深度差の閾値（m）。この値以上の落差がある場合に検出する。
MORPH_KERNEL_SIZE: ノイズ除去強度の調整。
